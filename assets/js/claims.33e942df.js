import{f as R,g as m,u as j,ao as Y,D as B,h as S,o,c as n,b as u,m as g,A as Z,U as Q,t as f,y,aA as X,F as x,e as M,l as I,j as _,d as G,a as L,x as P,ax as U,k as ee,aC as se,av as q,ae as ue,_ as te,q as ae,L as re,aw as ie,i as oe,aD as le,p as ne,r as w,aJ as de}from"./index.09a56ea9.js";import{N as ve}from"./Notification.b98f3bf7.js";import{_ as ce}from"./CompanyBarTop.a3a46566.js";const me={class:"orders-list-wrap"},pe={class:"orders-heading-info"},fe={class:"orders-heading-pagination"},ge={class:"orders-list"},Ce={class:"orders-list-row orders-list-heading"},he=["onClick"],ye={class:"orders-list-elem"},_e={class:"orders-list-elem"},De={class:"orders-list-elem"},Ae=["innerHTML"],Ee={class:"orders-list-elem"},Pe={class:"orders-list-elem",style:{"justify-content":"space-around"}},we={class:"orders-list-elem"},Se={key:0},Oe={class:"orders-list-info-elem"},$e={class:"orders-list-info-elem"},Be={key:0,class:"orders-list-info-about tooltip"},Ue=["onClick"],be={key:1,class:"orders-list-info-about tooltip"},Ie={class:"orders-list-info-download disable"},Le={key:0,class:"orders-list-info-elem orders-list-info-doc-wrap"},Ve={key:1,class:"orders-list-info-elem orders-list-info-doc-wrap"},ke=["href"],Fe=["href"],Te=["href"],Ne=["href"],xe={class:"orders-list-info-elem"},Me={key:1,class:"orders-list-info-row"},Ge={key:0,class:"orders-list-row orders-list-main-row"},Re=R({__name:"ClaimsListCard",props:{data:{type:Array,required:!0},contrAgent:{type:String},period:{type:String},status:{type:String},loading:{type:Boolean,default:!1},search:{type:Object,required:!0}},setup(s){const t=s,l=m({maxItemOnPage:10,currentPage:1}),A=j(),d=m(-1),O=m(-1),$=m(null),E=m(!1),C=m([]),b=m(-1),D="https://api.psk.expert",p=m([{name:"id",value:"",show:!1},{name:"name",value:"",show:!1},{name:"id",value:"",show:!1},{name:"id",value:"",show:!1},{name:"id",value:"",show:!1},{name:"id",value:"",show:!1}]);Y($,()=>{O.value=-1}),B(d,()=>{var a,e,r;if(d.value!=-1&&v.value&&Array.isArray((a=v.value[d.value].order)==null?void 0:a.checks)){let c=(r=(e=v.value[d.value].order)==null?void 0:e.checks)==null?void 0:r.map(i=>i.doc_status?null:A.dispatch(q.GET_ORDERS_DOCSTATUS,i.guid));c&&Promise.all(c).finally(()=>{})}}),B(()=>t.status,()=>{l.value.currentPage=1,d.value=-1}),B(()=>t.contrAgent,()=>{l.value.currentPage=1,d.value=-1}),B(()=>t.search,()=>{l.value.currentPage=1,d.value=-1}),B(()=>t.period,()=>{l.value.currentPage=1,d.value=-1});const v=S(()=>{let a=t.data.filter(e=>t.contrAgent==""||e.partner_guid==t.contrAgent);return a=a.filter(e=>z(e.date_create)),a=a.filter(e=>H(e)),a=a.filter(e=>h(e)),p.value[1].value!=""&&(a=a.filter(e=>`\u041F\u0440\u0435\u0442\u0435\u043D\u0437\u0438\u044F \u2116 ${e.bitrix_id} \u043E\u0442 ${e.date_create.substring(0,10)}`.indexOf(p.value[1].value)!=-1)),a}),V=a=>l.value.maxItemOnPage!=-1?a>=(l.value.currentPage-1)*l.value.maxItemOnPage&&a<l.value.currentPage*l.value.maxItemOnPage:!0,h=a=>{if(t.search.search=="")return!0;switch(t.search.id){case 1:return`\u041F\u0440\u0435\u0442\u0435\u043D\u0437\u0438\u044F \u2116 ${a.bitrix_id} \u043E\u0442 ${a.date_create.substring(0,10)}`.toUpperCase().indexOf(t.search.search.toUpperCase())!=-1;case 2:return a.date_create.toUpperCase().indexOf(t.search.search.toUpperCase())!=-1;case 3:return a.order?String(a.order.n).toUpperCase().indexOf(t.search.search.toUpperCase())!=-1:!1;case 4:return a.case?String(a.case).toUpperCase().indexOf(t.search.search.toUpperCase())!=-1:!1;default:return!0}},z=a=>{var e;if(!a)return!1;if(t.period=="\u0412\u0441\u0435")return!0;{const r=(e=t.period)==null?void 0:e.split(" - ")[0],c=r==null?void 0:r.substring(6,10),i=r==null?void 0:r.substring(3,5);return c==a.substring(6,10)&&i==a.substring(3,5)}},H=a=>t.status=="\u0412\u0441\u0435"?!0:a.order&&Array.isArray(a.order.checks)?a.order.checks.findIndex(e=>U[e.status+1]?t.status==U[e.status+1].name:!1)!=-1:!1,J=a=>{C.value.push(a),A.dispatch(ue.GET_BILL_FILE_SAVE,a).finally(()=>{C.value=C.value.filter(e=>e!==a)})},K=(a,e)=>{const c=A.getters.getCompanyStoragesData(a).find(i=>i.guid==e);return c?c.name.replace(/(^|\s)\S/g,i=>i.toUpperCase()).replace(/(ООО)|(")|(\s)|([а-я])/g,""):"\u0421\u043A\u043B\u0430\u0434"};return(a,e)=>(o(),n("div",me,[u("div",pe,[u("div",fe,[g(Z,{maxPage:l.value.maxItemOnPage!=-1?Math.ceil(v.value.length/l.value.maxItemOnPage):1,currentPage:l.value.currentPage,"onUpdate:currentPage":e[0]||(e[0]=r=>l.value.currentPage=r),maxItemOnPage:l.value.maxItemOnPage,"onUpdate:maxItemOnPage":e[1]||(e[1]=r=>l.value.maxItemOnPage=r)},null,8,["maxPage","currentPage","maxItemOnPage"])]),u("div",{class:"orders-heading-info-text",style:Q(v.value.length!=s.data.length?"visibility: visible":"visibility: hidden")}," \u041F\u043E\u043A\u0430\u0437\u0430\u043D\u043E "+f(v.value.length)+" \u0438\u0437 "+f(s.data.length),5)]),u("div",ge,[u("div",Ce,[e[9]||(e[9]=u("div",{class:"orders-list-elem"},"\u2116",-1)),u("div",{class:y("orders-list-elem"+(h.search!=""&&h.id==1?" active":"")+(p.value[1].value!=""?" active":""))},[g(X,{modelValue:p.value[1].value,"onUpdate:modelValue":e[2]||(e[2]=r=>p.value[1].value=r),show:p.value[1].show,"onUpdate:show":e[3]||(e[3]=r=>p.value[1].show=r)},null,8,["modelValue","show"]),e[8]||(e[8]=u("div",null,"\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435",-1)),u("div",{class:y("orders-list-elem-filter"+(p.value[1].show||p.value[1].value!=""?" active":"")),title:"\u0424\u0438\u043B\u044C\u0442\u0440",onClick:e[4]||(e[4]=r=>p.value[1].show=!0)},[...e[7]||(e[7]=[u("svg",{width:"13",height:"9",viewBox:"0 0 13 9",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[u("path",{class:"fill",d:"M7.00726 8.11117L12.7923 2.32601C12.9262 2.1922 13 2.01359 13 1.82313C13 1.63268 12.9262 1.45406 12.7923 1.32026L12.3664 0.894224C12.0888 0.616998 11.6378 0.616998 11.3606 0.894224L6.5027 5.75217L1.63936 0.888833C1.50545 0.755029 1.32694 0.681152 1.13659 0.681152C0.946033 0.681152 0.767522 0.755029 0.633507 0.888833L0.207681 1.31487C0.0737714 1.44878 -4.1357e-08 1.62729 -4.9682e-08 1.81774C-5.8007e-08 2.0082 0.0737714 2.18681 0.207681 2.32062L5.99802 8.11117C6.13236 8.24529 6.31171 8.31896 6.50238 8.31854C6.69378 8.31896 6.87303 8.24529 7.00726 8.11117Z",fill:"#A5A7A9"})],-1)])],2)],2),u("div",{class:y("orders-list-elem"+(s.contrAgent!=""?" active":""))},"\u041A\u043E\u043D\u0442\u0440\u0430\u0433\u0435\u043D\u0442",2),u("div",{class:y("orders-list-elem"+(h.search!=""&&h.id==2?" active":""))},"\u0414\u0430\u0442\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F",2),u("div",{class:y("orders-list-elem"+(h.search!=""&&h.id==3?" active":"")),style:{"justify-content":"space-around"}},"\u041D\u043E\u043C\u0435\u0440 \u0437\u0430\u043A\u0430\u0437\u0430",2),u("div",{class:y("orders-list-elem"+(s.status!="\u0412\u0441\u0435"?" active":""))},"\u0421\u0442\u0430\u0442\u0443\u0441",2),u("div",{class:y("orders-list-elem"+(h.search!=""&&h.id==4?" active":""))},"\u041F\u0440\u0438\u0447\u0438\u043D\u0430",2)]),(o(!0),n(x,null,M(v.value,(r,c)=>(o(),n("div",{key:c,class:y("orders-list-item"+(c==d.value?" active":""))},[V(c)?(o(),n("div",{key:0,class:"orders-list-row orders-list-main-row",onClick:i=>c===d.value?d.value=-1:d.value=c},[u("div",ye,[I(f(c+1)+" ",1),e[10]||(e[10]=u("div",{class:"table-arrow"},null,-1))]),u("div",_e," \u041F\u0440\u0435\u0442\u0435\u043D\u0437\u0438\u044F \u2116 "+f(r.bitrix_id)+" \u043E\u0442 "+f(r.date_create.substring(0,10)),1),u("div",De,[u("span",{innerHTML:r.partner_name},null,8,Ae)]),u("div",Ee,f(r.date_create.substring(0,10)),1),u("div",Pe,f(r.order?r.order.n:""),1),e[11]||(e[11]=u("div",{class:"orders-list-elem"},null,-1)),u("div",we,f(r.case),1)],8,he)):_("",!0),V(c)?(o(),n("div",{key:1,class:y(["orders-list-info",{active:c==d.value}]),onClick:e[5]||(e[5]=i=>O.value=-1)},[r.order&&Array.isArray(r.order.checks)?(o(),n("div",Se,[(o(!0),n(x,null,M(r.order.checks,(i,W)=>{var k,F,T,N;return o(),n("div",{class:"orders-list-info-row",key:W},[u("div",Oe,f(K(r.partner_guid,i.organization_id)),1),u("div",$e,[i.status>=2?(o(),n("div",Be,[u("div",{class:"orders-list-info-download",onClick:Ze=>J(i.guid)},[u("span",null," \u0421\u0447\u0451\u0442 \u043E\u0442 "+f(r.order.date.substring(0,10)),1),C.value.includes(r.guid)?(o(),G(L,{key:0,small:""})):_("",!0)],8,Ue),e[12]||(e[12]=u("span",{class:"tooltiptext"},"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0441\u0447\u0435\u0442",-1))])):(o(),n("div",be,[u("div",Ie," \u0421\u0447\u0451\u0442 \u043E\u0442 "+f(r.order.date.substring(0,10)),1),e[13]||(e[13]=u("span",{class:"tooltiptext"},[I("\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0441\u0447\u0435\u0442 \u043C\u043E\u0436\u043D\u043E \u0442\u043E\u043B\u044C\u043A\u043E "),u("br"),I(" \u043F\u043E\u0441\u043B\u0435 \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u044F \u0437\u0430\u043A\u0430\u0437\u0430")],-1))]))]),i.doc_status?(o(),n("div",Ve,[((k=i.doc_status)==null?void 0:k.StatusSchet)&&i.status>=2?(o(),n("a",{key:0,class:"orders-list-info-doc sc",href:`${P(D)}/api/order/print?id=${i.guid}&name=\u0421\u0447\u0435\u0442`,target:"_blank",title:"\u041E\u0442\u043A\u0440\u044B\u0442\u044C \u0441\u0447\u0435\u0442"},null,8,ke)):_("",!0),(F=i.doc_status)!=null&&F.StatusUPD?(o(),n("a",{key:1,class:"orders-list-info-doc upd",href:`${P(D)}/api/order/print?id=${i.guid}&name=\u0423\u041F\u0414`,target:"_blank",title:"\u0423\u043D\u0438\u0432\u0435\u0440\u0441\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u0435\u0440\u0435\u0434\u0430\u0442\u043E\u0447\u043D\u044B\u0439 \u0434\u043E\u043A\u0443\u043C\u0435\u043D\u0442"},null,8,Fe)):_("",!0),(T=i.doc_status)!=null&&T.StatusSF?(o(),n("a",{key:2,class:"orders-list-info-doc sf",href:`${P(D)}/api/order/print?id=${i.guid}&name=\u0421\u0424`,target:"_blank",title:"\u0421\u0447\u0451\u0442-\u0444\u0430\u043A\u0442\u0443\u0440\u0430"},null,8,Te)):_("",!0),(N=i.doc_status)!=null&&N.StatusUPK?(o(),n("a",{key:3,class:"orders-list-info-doc kor",href:`${P(D)}/api/order/print?id=${i.guid}&name=\u0423\u041A\u0414`,target:"_blank",title:"\u0423\u043D\u0438\u0432\u0435\u0440\u0441\u0430\u043B\u044C\u043D\u044B\u0439 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u0438\u0440\u043E\u0432\u043E\u0447\u043D\u044B\u0439 \u0434\u043E\u043A\u0443\u043C\u0435\u043D\u0442"},null,8,Ne)):_("",!0)])):(o(),n("div",Le,[g(L,{small:""})])),e[14]||(e[14]=u("div",{class:"orders-list-info-elem"},null,-1)),u("div",xe,f(P(U)[i.status+1]?P(U)[i.status+1].name:""),1),e[15]||(e[15]=u("div",{class:"orders-list-info-elem"},null,-1))])}),128))])):(o(),n("div",Me,[...e[16]||(e[16]=[ee('<div class="orders-list-info-elem"></div><div class="orders-list-info-elem"> \u0421\u0447\u0435\u0442 \u043E\u0442\u0441\u0443\u0442\u0432\u0443\u0435\u0442 </div><div class="orders-list-info-elem"></div><div class="orders-list-info-elem"></div><div class="orders-list-info-elem"></div><div class="orders-list-info-elem"></div><div class="orders-list-info-elem"></div>',7)])]))],2)):_("",!0)],2))),128)),s.data.length==0&&!s.loading?(o(),n("div",Ge,[...e[17]||(e[17]=[u("div",{class:"order-info"}," \u041F\u0440\u0435\u0442\u0435\u043D\u0437\u0438\u0439 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E. ",-1)])])):_("",!0)]),s.loading?(o(),G(L,{key:0,style:{width:"100%"}})):_("",!0),g(se,{modelValue:E.value,"onUpdate:modelValue":e[6]||(e[6]=r=>E.value=r),orderId:b.value},null,8,["modelValue","orderId"])]))}}),je=R({components:{PersonalBar:ae,Notification:ve,CompanyBarTop:ce,TopNav:re,SelectInput:ie,ClaimsListCard:Re},setup(){const s=j(),t=m(!0),l=m(""),A=m(0),d=m(0),O=m({id:1,search:""}),$=[{id:1,name:"\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435"},{id:2,name:"\u0414\u0430\u0442\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F"},{id:3,name:"\u041D\u043E\u043C\u0435\u0440 \u0437\u0430\u043A\u0430\u0437\u0430"},{id:4,name:"\u041F\u0440\u0438\u0447\u0438\u043D\u0430"}];oe(async()=>{var C;if(Promise.all([s.dispatch(q.GET_ORDERS),s.dispatch(le.GET_CLAIMS)]).finally(()=>{t.value=!1}),s.getters.getActiveCompanyId!==""){l.value=s.getters.getActiveCompanyId;return}s.getters.isCompanysLoad||await s.dispatch(ne.GET_COMPANYS),l.value=s.getters.getCompanys===[]?"":(C=s.getters.getCompanys[0])==null?void 0:C.uid});const E=()=>{s.commit(de.CLEAR_CLAIMS_NEW)};return{loading:t,searchColumn:$,search:O,filterCompanyUid:l,filterPeriod:A,filterStatus:d,OrdersSatusCode:U,companyBarTopData:S(()=>s.getters.getCompanysList),filterCompanyData:S(()=>s.getters.getCompanysListInput()),filterPeriodData:S(()=>s.getters.getOrdersDataPeriodArray),claimsList:S(()=>s.getters.getClaims),isOrders:S(()=>s.getters.isOrders),newClaim:E}}}),qe={class:"top-line product-page"},ze={class:"orders-heading"},He={class:"orders-heading-elem"},Je={class:"orders-heading-item"},Ke={class:"orders-heading-item"},We={class:"orders-heading-item","data-select2-id":"147"};function Ye(s,t,l,A,d,O){const $=w("CompanyBarTop"),E=w("Notification"),C=w("PersonalBar"),b=w("top-nav"),D=w("SelectInput"),p=w("ClaimsListCard");return o(),n("div",null,[u("div",qe,[g($,{data:s.companyBarTopData,modelValue:s.filterCompanyUid,"onUpdate:modelValue":t[0]||(t[0]=v=>s.filterCompanyUid=v)},null,8,["data","modelValue"]),g(E),g(C)]),g(b,{claims:s.isOrders,onOnClick:s.newClaim},null,8,["claims","onOnClick"]),u("div",ze,[u("div",He,[u("div",Je,[t[5]||(t[5]=u("div",{class:"orders-heading-text"},"\u041A\u043E\u043D\u0442\u0440\u0430\u0433\u0435\u043D\u0442:",-1)),g(D,{data:s.filterCompanyData,modelValue:s.filterCompanyUid,"onUpdate:modelValue":t[1]||(t[1]=v=>s.filterCompanyUid=v)},null,8,["data","modelValue"])]),u("div",Ke,[t[6]||(t[6]=u("div",{class:"orders-heading-text"},"\u0421\u0442\u0430\u0442\u0443\u0441:",-1)),g(D,{data:s.OrdersSatusCode,modelValue:s.filterStatus,"onUpdate:modelValue":t[2]||(t[2]=v=>s.filterStatus=v)},null,8,["data","modelValue"])]),u("div",We,[t[7]||(t[7]=u("div",{class:"orders-heading-text"},"\u041F\u0435\u0440\u0438\u043E\u0434:",-1)),g(D,{data:s.filterPeriodData,modelValue:s.filterPeriod,"onUpdate:modelValue":t[3]||(t[3]=v=>s.filterPeriod=v)},null,8,["data","modelValue"])]),u("div",{class:"orders-heading-clean",title:"\u0423\u0431\u0440\u0430\u0442\u044C \u0444\u0438\u043B\u044C\u0442\u0440\u044B",onClick:t[4]||(t[4]=v=>{s.filterCompanyUid="",s.filterPeriod=0,s.filterStatus=0})})]),t[8]||(t[8]=u("div",{class:"orders-heading-elem"},null,-1))]),g(p,{data:s.claimsList,loading:s.loading,contrAgent:s.filterCompanyUid,period:s.filterPeriodData[s.filterPeriod].name,status:s.OrdersSatusCode[s.filterStatus].name,search:s.search},null,8,["data","loading","contrAgent","period","status","search"])])}var ss=te(je,[["render",Ye]]);export{ss as default};
