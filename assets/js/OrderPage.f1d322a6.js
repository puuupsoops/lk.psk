import{f as j,u as Q,B as X,h as s,g as d,D as U,i as z,aq as p,aa as I,p as J,r as W,o as i,c as f,b as c,m as o,q as Z,L as uu,l as D,w as $,ab as eu,ac as tu,d as S,ar as au,j as w,as as ou,at as su,ad as ru,au as lu,Q as nu,ae as V,an as B}from"./index.09a56ea9.js";import{N as du}from"./Notification.b98f3bf7.js";import{_ as iu}from"./CompanyBarTop.a3a46566.js";import{_ as cu,a as mu,e as vu}from"./ProductSliderSmallCard.45465e8a.js";import{c as gu}from"./calcProductDiscount.1954a33d.js";const pu={class:"top-line product-page"},fu={key:0,class:"order-info"},Du={key:1},Eu={class:"content-wrap content-product-order-wrap"},_u={class:"content-wrap-elem"},Ou={class:"content-wrap-elem"},Pu={key:3,class:"content-heading-wrap product-heading-wrap"},Au={key:0,class:"content-heading-wrap-elem"},Cu={class:"content-wrap content-order-wrap"},Tu={class:"content-wrap-elem"},Ru={class:"content-wrap-elem"},ku=j({__name:"OrderPage",props:{article:{type:String}},setup(M){const E=M,u=Q(),P=X(),r=s({get:()=>u.getters.getLoader,set:n=>u.commit(nu.SET_LOADER,n)}),a=d(""),m=d(""),l=d(!1),_=d(""),v=d(!1),A=d(!1),g=d(!1),C=d([]),h=()=>{let n={article:u.getters.getProduct.ARTICLE,guid:u.getters.getProduct.UID,product:u.getters.getProduct,characteristics:C.value};u.dispatch(V.ADD_POSITION,n)},L=()=>{a.value==""?(l.value=!0,setTimeout(()=>{l.value=!1},5e3),_.value="\u0414\u043B\u044F \u043E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u044F \u0437\u0430\u043A\u0430\u0437\u0430 \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043D\u0442\u0440\u0430\u0433\u0435\u043D\u0442\u0430"):(v.value=!0,u.commit(p.ADD_ORDER_PARTNER_ID,a.value),setTimeout(()=>{u.dispatch(V.ADD_ORDER,u.getters.getOrderToAdd).catch(()=>{v.value=!1,l.value=!0,setTimeout(()=>{l.value=!1},5e3),_.value="\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u0437\u0430\u043A\u0430\u0437\u0430. \u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435."})},3e3))},K=()=>{v.value=!0,u.commit(p.ADD_ORDER_PARTNER_ID,a.value),setTimeout(()=>{u.dispatch(V.EDIT_ORDER_ACTION,u.getters.getOrderToAdd).catch(()=>{v.value=!1,l.value=!0,setTimeout(()=>{l.value=!1},5e3),_.value="\u041E\u0448\u0438\u0431\u043A\u0430 \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F \u0437\u0430\u043A\u0430\u0437\u0430. \u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u0437\u0436\u0435."})},3e3)},b=()=>{r.value=!0,u.dispatch(I.GET_PRODUCT_BY_ID,m.value).then(()=>{m.value=u.getters.getProduct.ID}).finally(()=>{r.value=!1})},G=async()=>{r.value=!0,u.commit(B.SET_KP_OFFER_POSITION,u.getters.getOrder.position),u.commit(B.SET_KP_STEP,2),r.value=!1,await P.push("/kp")};U(()=>E.article,n=>{n&&(r.value=!0,u.dispatch(I.SEARCH_PRODUCT,E.article).then(()=>{u.getters.getProduct.ID?m.value=u.getters.getProduct.ID:P.push({name:"Order"})}).finally(()=>{r.value=!1}))}),U(a,()=>{u.getters.getOrder.edit||u.commit(p.ADD_ORDER_PARTNER_ID,a.value),u.commit(p.CALC_ORDER)}),z(async()=>{if(u.commit(p.ADD_ORDER_PARTNER_ID,a.value),m.value=u.getters.getProduct.ID,E.article&&(r.value=!0,u.dispatch(I.SEARCH_PRODUCT,E.article).then(()=>{u.getters.getProduct.ID?m.value=u.getters.getProduct.ID:P.push({name:"Order"})}).finally(()=>{r.value=!1})),u.getters.getActiveCompanyId!==""){a.value=u.getters.getActiveCompanyId;return}u.getters.isCompanysLoad||await u.dispatch(J.GET_COMPANYS),a.value=u.getters.getCompanys===[]?"":u.getters.getCompanys[0].uid});const T=s(()=>{var t;const n=String(u.getters.getProduct.STATUS),e=Number((t=u.getters.getProduct)==null?void 0:t.MAX_DISCOUNT),O=Number(u.getters.getCompanyDiscount(a.value,u.getters.getProductOffersORGGUID));return gu(n,e,O)}),R=s(()=>u.getters.isProduct),k=s(()=>u.getters.getCompanysList),x=s(()=>u.getters.getProductOffers),y=s(()=>u.getters.getProduct),q=s(()=>u.getters.getProductFound),H=s(()=>u.getters.getProductImages),N=s(()=>u.getters.isOrder),F=s(()=>u.getters.getOrder),Y=s(()=>u.getters.getOrderDraftCount);return(n,e)=>{const O=W("router-link");return i(),f("div",null,[c("div",pu,[o(iu,{data:k.value,modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value=t)},null,8,["data","modelValue"]),o(du),o(Z)]),o(uu,{toDraft:"",draft:Y.value,onOnClick:e[1]||(e[1]=t=>A.value=!0)},null,8,["draft"]),R.value?(i(),f("div",Du,[o(eu,{to:"order",show:g.value,"onUpdate:show":e[2]||(e[2]=t=>g.value=t)},null,8,["show"]),o(cu,{title:String(y.value.NAME),price:String(y.value.PRICE_OPT),discount:T.value,status:String(y.value.STATUS),onShowSearch:e[3]||(e[3]=t=>g.value=!g.value)},null,8,["title","price","discount","status"]),c("div",Eu,[c("div",_u,[o(tu,{data:q.value,cardType:"order",modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=t=>m.value=t),onOnClick:e[5]||(e[5]=t=>b()),onShowSearch:e[6]||(e[6]=t=>g.value=!g.value)},null,8,["data","modelValue"])]),c("div",Ou,[o(mu,{data:x.value,discount:T.value,modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=t=>C.value=t),onOnClick:e[8]||(e[8]=t=>h())},null,8,["data","discount","modelValue"])])])])):(i(),f("div",fu,[e[15]||(e[15]=D(" \u0414\u043B\u044F \u043E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u044F \u0437\u0430\u043A\u0430\u0437\u0430 \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u043E\u0432\u0430\u0440 \u0432 ",-1)),o(O,{to:"/catalog/catalog",class:"order-info-link"},{default:$(()=>[...e[13]||(e[13]=[D("\u043A\u0430\u0442\u0430\u043B\u043E\u0433\u0435",-1)])]),_:1}),e[16]||(e[16]=D(" \u0438\u043B\u0438 \u0432\u043E\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0439\u0442\u0435\u0441\u044C ",-1)),o(O,{to:"/product",class:"order-info-link"},{default:$(()=>[...e[14]||(e[14]=[D("\u043F\u043E\u0438\u0441\u043A\u043E\u043C",-1)])]),_:1}),e[17]||(e[17]=D(". ",-1))])),N.value?(i(),S(au,{key:2,discount:T.value,data:F.value},null,8,["discount","data"])):(i(),f("div",Pu,[R.value?(i(),f("div",Au,[...e[18]||(e[18]=[c("div",{class:"order-info"},"\u0414\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u043F\u043E\u0437\u0438\u0446\u0438\u0438 \u043A \u0437\u0430\u043A\u0430\u0437\u0443 \u0438 \u0442\u043E\u0433\u0434\u0430 \u043E\u043D \u0431\u0443\u0434\u0435\u0442 \u0441\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u043D",-1)])])):w("",!0)])),c("div",Cu,[c("div",Tu,[N.value?(i(),S(ou,{key:0,data:F.value,companys:k.value,modelValue:a.value,"onUpdate:modelValue":e[9]||(e[9]=t=>a.value=t),onOnClickAdd:L,onOnClickEdit:K,onGoToKP:G},null,8,["data","companys","modelValue"])):w("",!0)]),c("div",Ru,[R.value?(i(),S(vu,{key:0,data:H.value},null,8,["data"])):w("",!0)])]),o(su,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=t=>v.value=t)},null,8,["modelValue"]),o(ru,{modelValue:l.value,"onUpdate:modelValue":e[11]||(e[11]=t=>l.value=t),message:_.value},null,8,["modelValue","message"]),o(lu,{modelValue:A.value,"onUpdate:modelValue":e[12]||(e[12]=t=>A.value=t)},null,8,["modelValue"])])}}});export{ku as default};
